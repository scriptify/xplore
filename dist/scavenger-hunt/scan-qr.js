"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function missingParam(a){throw new Error("Missing parameter: '".concat(a,"'"))}var UniversalQrScanner=/*#__PURE__*/function(){function a(b){var c=b.video,d=void 0===c?missingParam("video element"):c;_classCallCheck(this,a),this.video=d,this.events={},this.tick=this.tick.bind(this),this.setup()}return _createClass(a,[{key:"setup",value:function c(){var a=this,b=this.video;document.querySelector("body").insertAdjacentHTML("beforeend","\n      <canvas hidden id=\"universalQrCodeScannerCanvas\" style=\"width: 100%;\"></canvas>\n    "),this.canvas=document.querySelector("#universalQrCodeScannerCanvas"),this.canvasCtx=this.canvas.getContext("2d"),navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(c){b.srcObject=c,b.setAttribute("playsinline",!0),b.play(),a.animFrameId=requestAnimationFrame(a.tick)})}},{key:"execEvents",value:function c(a,b){this.events[a]&&this.events[a].forEach(function(a){return a(b)})}},{key:"tick",value:function f(){var a=this.video,b=this.canvas,c=this.canvasCtx;if(a.readyState===a.HAVE_ENOUGH_DATA&&0!==a.videoHeight&&0!==a.videoWidth){b.height=a.videoHeight,b.width=a.videoWidth,c.drawImage(a,0,0,b.width,b.height);var d=c.getImageData(0,0,b.width,b.height),e=jsQR(d.data,d.width,d.height,{inversionAttempts:"dontInvert"});e&&this.execEvents("scan",e.data)}this.hasStopped||requestAnimationFrame(this.tick)}},{key:"addEventListener",value:function c(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:missingParam("callback function (2\xB0)");this.events[a]?this.events[a].push(b):this.events[a]=[b]}},{key:"stop",value:function a(){this.hasStopped=!0,this.canvas&&this.canvas.remove(),this.animFrameId&&cancelAnimationFrame(this.animFrameId)}}]),a}();